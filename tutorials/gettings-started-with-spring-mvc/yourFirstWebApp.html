<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Getting Started with Spring-MVC: Creating Your First Web Application</title>
  <link rel="stylesheet" href="../scripts/dojo-1.2/dijit/themes/tundra/tundra.css" type="text/css">
  <link rel="stylesheet" href="../scripts/dojo-1.2/dojox/highlight/resources/highlight.css" type="text/css">
  <link rel="stylesheet" href="../scripts/dojo-1.2/dojox/highlight/resources/pygments/ide.css" type="text/css">
  <link rel="stylesheet" href="../styles/tutorial-1.0.css" type="text/css">
  <script type="text/javascript" src="../scripts/dojo-1.2/dojo/dojo.js"></script>
  <script type="text/javascript" src="../scripts/spring-js-2.0/Spring.js"></script>
  <script type="text/javascript" src="../scripts/spring-js-2.0/Spring-Dojo.js"></script>
</head>
<body class="tundra">
<a href="http://www.springsource.org"><img src="../images/logo.png"></a>
<h1> Creating Your First Web Application</h1>
<div id="section1" class="section">
  <h2>Create your project</h2>
  <div id="sts">
    <ol>
      <li>
        Download the&nbsp;<a href="http://www.springsource.com/products/sts">SpringSource Tool Suite</a>
        (STS). After downloading completes, extract the archive to your directory of choice. 
      </li>
      <li>
        Open STS and close the Welcome screen.
        Access File -&gt; New -&gt; Spring Template Project.&nbsp;<br clear="all">
        <br clear="all">
        <img style="width: 574px; height: 186px;" alt="New Project Menu" src="images/new-project-menu.png">&nbsp;<br clear="all">
        <br clear="all">
        Then select "Spring MVC Project" and press Next. Enter 'gettingstarted' for your
        project name and 'com.springsource.samples.springmvc' as the top level package name.<br clear="all">
        <br clear="all">
        <img style="width: 526px; height: 387px;" alt="New Project Settings" src="images/new-project-settings.png"><br clear="all">
        <br clear="all">
        You will then have the&nbsp;project structure shown below:<br clear="all">
        <br clear="all">
        <img style="width: 242px; height: 312px;" alt="Package Explorer" src="images/new-project-packag-explorer.png">
      </li>
      <li>
        Next, right-click on your project in your Package Explorer view,and select Run As -&gt; Run On Server.<br clear="all">
        <br clear="all">
        <img style="width: 500px; height: 495px;" alt="Run On Server" src="images/run-on-server.png">&nbsp;<br clear="all">
        <br clear="all">
        Now select the tc Server instance that STS has automatically defined for you, check the 'Always use this server'
        box and press Finish. The server will start your application, and uou should see your application's welcome page 
        appear in the embedded web browser as shown below.
        Alternatively, you can access your application in an external browser&nbsp;
        <span style="text-decoration: underline;">http://localhost:8080/gettingstarted/</span><br clear="all">
        <br clear="all">
        <img style="width: 770px; height: 315px;" alt="MVC Welcome Screen" src="images/welcome-screen-webapp.png">
        <br clear="all">
      </li>
    </ol>
  </div>
</div>
<div id="section2" class="section">
  <h2>Eclipse Project details</h2>
  <div id="details">
    Let's first take a look at the setup of the created sample project. If you don't care and just want to start coding,
    feel free to skip to the <a href="#addController">next section</a>!<br clear="all">
    As you can tell from the pom.xml in the bottom of the Package Explorer, the project is using Maven to define its
    dependencies. STS ships with the m2eclipse plugin that provides Maven support to your Eclipse projects, so these
    dependencies as well as their transitive dependencies are made available using a <em>Maven Dependencies</em>
    classpath container.<br clear="all"> 
    <br clear="all">
    <img style="width: 243px; height: 296px;" alt="Maven Dependencies" src="images/maven-dependencies.png"><br clear="all">
    <br clear="all">
    When you expand it you will notice some Spring jars, Servlet and JSP related jars, log4j, junit
    and a <em>urlrewritefilter</em> jar. The latter is used to get rid of the servlet path in your URLs and to map the
    root page of the application.<br clear="all">
    Now open the web.xml that you can find under <span class="file">src/main/webapp/WEB-INF</span>. 
    It defines the UrlRewriteFilter and a Spring
    MVC <em>DispatcherServlet</em>. The latter is the heart of Spring MVC: every request starting with /app/ will be
    handled by this servlet. It uses Spring for its configuration: the <em>contextConfigLocation</em> init-param can be
    used to provide one or more config files. In this case, every XML file in the 
    <span class="file">/WEB-INF/spring</span> directory will be
    read. There's two of those: <span class="file">mvc-config.xml</span> contains configuration specific to Spring-MVC, 
    <span class="file">app-config</span> contains the
    configuration for the rest of the application. The only thing the latter defines at the moment is this:
    <pre>&lt;context:component-scan  base-package="com.springsource.samples" /&gt;</pre>
    This instructs Spring to search for classes in that package and its subpackages that are annotated with a
    <em>stereotype</em> annotation like @Component or @Controller and to define a Spring bean definition for those
    classes. The <span class="file">mvc-config.xml</span> uses the new <em>mvc</em> namespace to set things up for 
    annotation-driven MVC configuration and registers an InternalResourceViewResolver that maps view names to JSP pages.<br clear="all">
    Now open the <span class="file">WelcomeController</span>: it's annotated with @Controller to indicate that it is a Spring MVC controller and
    has a single method that will be called when users access the application with the URL <span class="file">/app/welcome</span> 
    (<span class="file">/app</span> is the servlet path, <span class="file">/welcome</span> the path info) using the
    @RequestMapping annotation. The method doesn't do or return anything, which means that Spring will simply try to
    render a view called <em>welcome</em>, per the request's path info. That will be mapped to the <span
    class="file">welcome.jsp</span> file under the <span class="file">WEB-INF/views</span> directory, which then renders
    the page you saw in the browser window.<br clear="all">
    Finally there's the <span class="file">urlrewrite.xml</span> file that contains the configuration for the rewrite
    filter. When users access the application root (<span class="file">http://localhost:8080/gettingstarted/</span>) it
    will map that to the <span class="file">/app/welcome</span> URL, and all other incoming requests will have 
    <span class="file">/app</span> prepended so that they map to the DispatcherServlet, which will be stripped again
    from the outgoing URLs. This is done to make the URLs a bit nicer: without the filter, 
    they would always need to have <span class="file">/app</span> in them, and mapping
    the DispatcherServlet to<span class="file">/*</span> is also not an option as it causes issues with the JSP support 
    of the servlet container.
  </div>
</div>
<div id="section3" class="section">
  <h2>Add a new page</h2>
  <div id="newpage">
    <a name="addController"/>
    <ol>
      <li>
        Create a new class called <span class="file">GreetingController</span> under the 
        <span class="file">com.springsource.samples</span> package using the following code:
        <pre><code>@Controller
public class GreetingController {
	
	private List<String> greetings = new ArrayList<String>();
	
	public GreetingController() {
		greetings.add("Hello World");
		greetings.add("Hallo Welt");
	}
	
} </code></pre>
        Don't forget to add the appropriate imports. You can use the Organize Imports feature of Eclipse for this, the
        key shortcut is Ctrl+Shift+o.
      </li>
      <li>
        Now add a method that will show a list of the defined greetings like this:
        <pre><code>	@RequestMapping("/greetings")
	public void list(Model model) {
		model.addAttribute("greetings", greetings);
	} </code></pre>
        The <em>Model</em> type is a <span class="file">org.springframework.ui.Model</span>, make sure you add the
        correct import for that.
      </li>
      <li>
        Now add a new file called <span class="file">greetings.jsp</span> under the <span class="file">WEB-INF/views</span>
        directory (to be found under <span class="file">src/main/webapp</span>) that will render that greetings list 
        using the following file contents:
        <pre><code>&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Greetings&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Greetings in multiple languages:&lt;/h1&gt;
&lt;ul&gt;
    &lt;c:forEach items="${greetings}" var="greeting"&gt;
        &lt;li&gt;${greeting}&lt;/li&gt;
    &lt;/c:forEach&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt; </code></pre>
      </li>
      <li>
        Now restart your server and navigate to 
        <a href="http://localhost:8080/gettingstarted/greetings">http://localhost:8080/gettingstarted/greetings</a>
        to see the list.<br clear="all">
        <br clear="all">
        <img style="width: 559px; height: 184px;" alt="The initial Greetings page" src="images/greetings-page-1.png">&nbsp;<br clear="all">
        <br clear="all">
      </li>
    </ol>
  </div>
</div>
<div id="section4" class="section">
  <h2>Add greetings to the list</h2>
  <div id="addgreeting">
    Let's create an option to add more greetings.
    <ol>
      <li>
        Add a simple form to your JSP, right under the unordered list:
        <pre><code>&lt;form action="&lt;c:url value='/add'/&gt;" method="post"&gt;
    &lt;input name="greeting"/&gt;
    &lt;input type="submit" value="Submit"/&gt;
&lt;/form&gt; </code></pre>
      </li>
      <li>
        Add the following method to your <span class="file">GreetingsController</span>:
        <pre><code>@RequestMapping(value="/add", method=RequestMethod.POST)
public String add(@RequestParam String greeting) {
	greetings.add(greeting);
	return "redirect:/greetings";
} </pre></code>
        Don't forget to add an import for the <em>RequestMethod</em>. 
      </li>
      <li>
      Now restart your server again and refresh your browser window: you will now be able to add new greetings and to
      see the result. 
      </li>
    </ol>
  </div>
</div>
<div id="section5" class="section">
  <h2>What's next</h2>
  <div id="whatsnext">
  </div>
</div>
<script type="text/javascript">
dojo.require("dojox.highlight.languages.xml");
dojo.addOnLoad(function(){
dojo.query("code").forEach(dojox.highlight.init);
});
Spring.addDecoration(new Spring.ElementDecoration({
elementId : "sts",
widgetType : "dijit.layout.ContentPane",
widgetAttrs : {
title: "SpringSource Tool Suite",
selected: "true"
}
}));
Spring.addDecoration(new Spring.ElementDecoration({
elementId : "command-line",
widgetType : "dijit.layout.ContentPane",
widgetAttrs : {
title: "Command line"
}
}));
Spring.addDecoration(new Spring.ElementDecoration({
elementId : "environments",
widgetType : "dijit.layout.TabContainer",
widgetAttrs : {
style: "width: 100%; height: 200px;"
}
}));
dojo.query('.section > h2').forEach(function(titleElement){
Spring.addDecoration(new Spring.ElementDecoration({
elementId : titleElement.parentNode.id,
widgetType : 'dijit.TitlePane',
widgetAttrs : { title : titleElement.innerHTML,
open : false
}
}));
}).style('display','none');
</script>
</body>
</html>
